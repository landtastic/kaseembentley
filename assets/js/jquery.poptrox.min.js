!function(a){a.fn.poptrox_disableSelection=function(){return a(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},a.fn.poptrox=function(b){function d(){f=a(window).width(),g=a(window).height()+h.windowHeightPad;var b=Math.abs(q.width()-q.outerWidth()),c=Math.abs(q.height()-q.outerHeight()),d=(s.width(),s.height(),f-2*h.windowMargin-b),e=g-2*h.windowMargin-c;q.css("min-width",h.popupWidth).css("min-height",h.popupHeight),r.children().css("max-width",d).css("max-height",e)}if(0==this.length)return a(this);if(this.length>1){for(var e=0;e<this.length;e++)a(this[e]).poptrox(b);return a(this)}var f,g,h=a.extend({preload:!1,baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,windowHeightPad:0,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"<!--<a href=''>Download</a>-->",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},b),i=a(this),j=a("body"),k=a('<div class="'+h.overlayClass+'"></div>'),l=a(window),m=[],n=0,o=!1,p=new Array;h.usePopupLoader||(h.popupLoaderSelector=null),h.usePopupCloser||(h.popupCloserSelector=null),h.usePopupCaption||(h.popupCaptionSelector=null),h.usePopupNav||(h.popupNavPreviousSelector=null,h.popupNavNextSelector=null);var q;q=a(h.popupSelector?h.popupSelector:'<div class="'+h.popupClass+'">'+(h.popupLoaderSelector?'<div class="loader">'+h.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(h.popupCaptionSelector?'<div class="caption"></div>':"")+(h.popupCloserSelector?'<span class="closer">'+h.popupCloserText+"</span>":"")+(h.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(h.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>");var r=q.find(".pic"),s=a(),t=q.find(h.popupLoaderSelector),u=q.find(h.popupCaptionSelector),v=q.find(h.popupCloserSelector),w=q.find(h.popupNavNextSelector),x=q.find(h.popupNavPreviousSelector),y=w.add(x);if(h.usePopupDefaultStyling&&(q.css("background",h.popupBackgroundColor).css("color",h.popupTextColor).css("padding",h.popupPadding+"px"),u.length>0&&(q.css("padding-bottom",h.popupCaptionHeight+"px"),u.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",h.popupCaptionHeight+"px").css("line-height",h.popupCaptionHeight+"px"),h.popupCaptionTextSize&&u.css("font-size",popupCaptionTextSize)),v.length>0&&v.html(h.popupCloserText).css("font-size",h.popupCloserTextSize).css("background",h.popupCloserBackgroundColor).css("color",h.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),t.length>0&&t.html("").css("position","relative").css("font-size",h.popupLoaderTextSize).on("startSpinning",function(b){var c=a("<div>"+h.popupLoaderText+"</div>");c.css("height",Math.floor(h.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(h.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((q.height()-c.height()+(u.length>0?u.height():0))/2)).css("color",h.popupTextColor?h.popupTextColor:"").on("xfin",function(){c.fadeTo(300,.5,function(){c.trigger("xfout")})}).on("xfout",function(){c.fadeTo(300,.05,function(){c.trigger("xfin")})}).trigger("xfin"),t.append(c)}).on("stopSpinning",function(a){var b=t.find("div");b.remove()}),2==y.length)){y.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection();var z,A;h.usePopupEasyClose?(z="100px",A="100px"):(z="75%",A="25%"),w.css("right","0").css("width",z).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),x.css("left","0").css("width",A).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')}return l.on("resize orientationchange",function(){d()}),u.on("update",function(a,b){b&&0!=b.length||(b=h.popupBlankCaptionText),u.html(b)}),v.css("cursor","pointer").on("click",function(a){return a.preventDefault(),a.stopPropagation(),q.trigger("poptrox_close"),!0}),w.on("click",function(a){a.stopPropagation(),a.preventDefault(),q.trigger("poptrox_next")}),x.on("click",function(a){a.stopPropagation(),a.preventDefault(),q.trigger("poptrox_previous")}),k.css("position","fixed").css("left",0).css("top",0).css("z-index",h.baseZIndex).css("width","100%").css("height","100%").css("text-align","center").css("cursor","pointer").appendTo(h.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;"></div>').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+h.overlayColor+";opacity:"+h.overlayOpacity+";filter:alpha(opacity="+100*h.overlayOpacity+');"></div>').hide().on("touchmove",function(a){return!1}).on("click",function(a){a.preventDefault(),a.stopPropagation(),q.trigger("poptrox_close")}),q.css("display","inline-block").css("vertical-align","middle").css("position","relative").css("z-index",1).css("cursor","auto").appendTo(k).hide().on("poptrox_next",function(){var a=n+1;a>=m.length&&(a=0),q.trigger("poptrox_switch",[a])}).on("poptrox_previous",function(){var a=n-1;0>a&&(a=m.length-1),q.trigger("poptrox_switch",[a])}).on("poptrox_reset",function(){d(),q.data("width",h.popupWidth).data("height",h.popupHeight),t.hide().trigger("stopSpinning"),u.hide(),v.hide(),y.hide(),r.hide(),s.attr("src","").detach()}).on("poptrox_open",function(a,b){return!!o||(o=!0,h.useBodyOverflow&&j.css("overflow","hidden"),h.onPopupOpen&&h.onPopupOpen(),q.addClass("loading"),void k.fadeTo(h.fadeSpeed,1,function(){q.trigger("poptrox_switch",[b,!0])}))}).on("poptrox_switch",function(b,c,e){var f;if(!e&&o)return!0;if(o=!0,q.addClass("loading").css("width",q.data("width")).css("height",q.data("height")),u.hide(),s.attr("src")&&s.attr("src",""),s.detach(),f=m[c],s=f.object,s.off("load"),r.css("text-indent","-9999px").show().append(s),"ajax"==f.type?a.get(f.src,function(a){s.html(a),s.trigger("load")}):s.attr("src",f.src),"image"!=f.type){var g,i;g=f.width,i=f.height,"%"==g.slice(-1)&&(g=parseInt(g.substring(0,g.length-1))/100*l.width()),"%"==i.slice(-1)&&(i=parseInt(i.substring(0,i.length-1))/100*l.height()),s.css("position","relative").css("outline","0").css("z-index",h.baseZIndex+100).width(g).height(i)}t.trigger("startSpinning").fadeIn(300),q.show(),h.popupIsFixed?(q.removeClass("loading").width(h.popupWidth).height(h.popupHeight),s.load(function(){s.off("load"),t.hide().trigger("stopSpinning"),u.trigger("update",[f.captionText]).fadeIn(h.fadeSpeed),v.fadeIn(h.fadeSpeed),r.css("text-indent",0).hide().fadeIn(h.fadeSpeed,function(){o=!1}),n=c,y.fadeIn(h.fadeSpeed)})):s.load(function(){d(),s.off("load"),t.hide().trigger("stopSpinning");var a=s.width(),b=s.height(),e=function(){u.trigger("update",[f.captionText]).fadeIn(h.fadeSpeed),v.fadeIn(h.fadeSpeed),r.css("text-indent",0).hide().fadeIn(h.fadeSpeed,function(){o=!1}),n=c,y.fadeIn(h.fadeSpeed),q.removeClass("loading").data("width",a).data("height",b).css("width","auto").css("height","auto")};a==q.data("width")&&b==q.data("height")?e():q.animate({width:a,height:b},h.popupSpeed,"swing",e)}),"image"!=f.type&&s.trigger("load")}).on("poptrox_close",function(){return!(!o||h.usePopupForceClose)||(o=!0,q.hide().trigger("poptrox_reset"),h.onPopupClose&&h.onPopupClose(),void k.fadeOut(h.fadeSpeed,function(){h.useBodyOverflow&&j.css("overflow","auto"),o=!1}))}).trigger("poptrox_reset"),h.usePopupEasyClose?(u.on("click","a",function(a){a.stopPropagation()}),q.css("cursor","pointer").on("click",function(a){a.stopPropagation(),a.preventDefault(),q.trigger("poptrox_close")})):q.on("click",function(a){a.stopPropagation()}),l.keydown(function(a){if(q.is(":visible"))switch(a.keyCode){case 37:case 32:if(h.usePopupNav)return q.trigger("poptrox_previous"),!1;break;case 39:if(h.usePopupNav)return q.trigger("poptrox_next"),!1;break;case 27:return q.trigger("poptrox_close"),!1}}),i.find(h.selector).each(function(b){var d,e,f=a(this),g=f.find("img"),i=f.data("poptrox");if("ignore"!=i&&f.attr("href")){if(d={src:f.attr("href"),captionText:g.attr("title"),width:null,height:null,type:null,object:null,options:null},h.caption){if("function"==typeof h.caption)c=h.caption(f);else if("selector"in h.caption){var j;j=f.find(h.caption.selector),"attribute"in h.caption?c=j.attr(h.caption.attribute):(c=j.html(),h.caption.remove===!0&&j.remove())}}else c=g.attr("title");if(d.captionText=c,i){var k=i.split(",");0 in k&&(d.type=k[0]),1 in k&&(e=k[1].match(/([0-9%]+)x([0-9%]+)/),e&&3==e.length&&(d.width=e[1],d.height=e[2])),2 in k&&(d.options=k[2])}if(!d.type)switch(e=d.src.match(/\/\/([a-z0-9\.]+)\/.*/),(!e||e.length<2)&&(e=[!1]),e[1]){case"api.soundcloud.com":d.type="soundcloud";break;case"youtu.be":d.type="youtube";break;case"vimeo.com":d.type="vimeo";break;case"wistia.net":d.type="wistia";break;case"bcove.me":d.type="bcove";break;default:d.type="image"}switch(e=d.src.match(/\/\/[a-z0-9\.]+\/(.*)/),d.type){case"iframe":d.object=a('<iframe src="" frameborder="0"></iframe>'),d.object.on("click",function(a){a.stopPropagation()}).css("cursor","auto"),d.width&&d.height||(d.width="600",d.height="400");break;case"ajax":d.object=a('<div class="poptrox-ajax"></div>'),d.object.on("click",function(a){a.stopPropagation()}).css("cursor","auto").css("overflow","auto"),d.width&&d.height||(d.width="600",d.height="400");break;case"soundcloud":d.object=a('<iframe scrolling="no" frameborder="no" src=""></iframe>'),d.src="//w.soundcloud.com/player/?url="+escape(d.src)+(d.options?"&"+d.options:""),d.width="600",d.height="166";break;case"youtube":d.object=a('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),d.src="//www.youtube.com/embed/"+e[1]+(d.options?"?"+d.options:""),d.width&&d.height||(d.width="800",d.height="480");break;case"vimeo":d.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),d.src="//player.vimeo.com/video/"+e[1]+(d.options?"?"+d.options:""),d.width&&d.height||(d.width="800",d.height="480");break;case"wistia":d.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),d.src="//fast.wistia.net/"+e[1]+(d.options?"?"+d.options:""),d.width&&d.height||(d.width="800",d.height="480");break;case"bcove":d.object=a('<iframe src="" frameborder="0" allowFullScreen="1" width="100%"></iframe>'),d.src="//bcove.me/"+e[1]+(d.options?"?"+d.options:""),d.width&&d.height||(d.width="640",d.height="360");break;default:if(d.object=a('<img src="" alt="" style="vertical-align:bottom" />'),h.preload){var e=document.createElement("img");e.src=d.src,p.push(e)}d.width=f.attr("width"),d.height=f.attr("height")}"file:"==window.location.protocol&&d.src.match(/^\/\//)&&(d.src="http:"+d.src),m.push(d),g.removeAttr("title"),f.removeAttr("href").css("cursor","pointer").css("outline",0).on("click",function(a){a.preventDefault(),a.stopPropagation(),q.trigger("poptrox_open",[b])})}}),i.prop("_poptrox",h),i}}(jQuery);